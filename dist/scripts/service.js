var url={parse:function(e){var r=document.createElement("a");return r.href=e,r}},scripts=document.getElementsByTagName("script"),path=scripts[scripts.length-1].src.split("?")[0],mydir=path.split("/").slice(0,-1).join("/")+"/",scriptLocation=url.parse(mydir);angular.module("servicesModule").factory("service",["api","$q",function(e,r){var t={};for(var n in e)e.hasOwnProperty(n)&&"function"==typeof e[n]&&(t[n]=function(t){return function(){return n=e[t].apply(this,Array.prototype.slice.call(arguments)),o=r.defer(),n.then(function(e){if(!e)return o.reject("未收到服务器数据");(e=e.data).isSuccess?""===e.result||0===e.result||!1===e.result?o.resolve(e.result):o.resolve(e.result||e.results):(console.error(e),console.error(n.value),void 0!==e.code?(o.reject(e),"302"===String(e.code)&&(window.location.href=e.message)):o.reject(e.message||"服务器返回错误的数据"))},function(e){e=e?e.data:"未收到服务器数据",o.reject(e),e&&e.code&&"401"===String(e.code)&&"/sign-in"!==window.location.pathname&&(window.location.href="/sign-in?return_url="+encodeURIComponent(window.location.href))}),o.promise;var n,o}}(n));return t.executePromiseAvoidDuplicate=function(e,t,n){var o=r.defer();return e[t]?(o.reject("submitting..."),o):(e[t]=!0,n().finally(function(){e[t]=!1}))},t.postSync=function(e){var r=new Worker(mydir+"syncRequest.js");r.onmessage=function(e){console.log(e),alert(e.data)},r.postMessage("POST")},t}]);